<!-- Screening Questionnaire (extends base.html) -->
<!-- rishit chatterjee -->



{% extends "base.html" %}

{% block extra_css %}
  {{ super() }}
{% endblock %}

{% block title %}
  {% if step == 0 %}SYNTEST — Screening{% elif step == 1 %}SYNTEST — Step 1 of 5{% elif step == 2 %}SYNTEST — Step 2 of 5{% elif step == 3 %}SYNTEST — Step 3 of 5{% elif step == 4 %}SYNTEST — Step 4 of 5{% else %}SYNTEST — Step 5 of 5{% endif %}
{% endblock %}

{% block content %}
  <div class="container container-md">

  {# security console intentionally rendered on dedicated view #}

  {# -------------------- INTRO (step = 0) -------------------- #}
  {% if step == 0 %}
    <section class="card">
      <h1 class="card-title">Take the questionnaire</h1>

      <p class="lead">
        In this first screening, we'll check basic eligibility and your experiences.
      </p>

      <!-- Add stable id="consent" so JS can bind reliably -->
      <label class="checkbox-group">
        <input id="consent" type="checkbox" data-audit-label="Consent agreement" />
        <span>I consent to take part in this study.</span>
      </label>

      <p class="text-muted mb-3">
        By checking this box, you acknowledge that you have read and understood the
        study information sheet, agree to participate voluntarily, and consent to the
        collection and use of your data for research purposes. You may withdraw at any
        time without penalty.
      </p>

      <!-- Add stable id="begin-screening" so JS can enable/disable this link -->
      <a id="begin-screening" class="btn btn-primary btn-block" href="{{ url_for('flow', step=1) }}">Begin screening</a>
    </section>

    <p class="text-muted text-center mt-3">You can stop at any time.</p>
  {% endif %}

  {# -------------------- STEP 1 (Health & Substances) -------------------- #}
  {% if step == 1 %}
    <div class="progress">
      <div class="progress-top"><span>Step 1 of 5</span><span>20%</span></div>
      <div class="progress-track"><div class="progress-bar" style="width:20%"></div></div>
    </div>

    <section class="card">
      <span class="chip chip-primary">Health &amp; Substances</span>
      <h2>Confirm none apply to you:</h2>

      <label class="checkbox-group">
        <input type="checkbox" data-audit-label="Substance exclusion — recreational drugs">
        <span>Use of recreational drugs including marijuana, LSD, or psychedelics</span>
      </label>
      <label class="checkbox-group">
        <input type="checkbox" data-audit-label="Substance exclusion — neurological condition">
        <span>Neurological condition or treatment affecting perception</span>
      </label>
      <label class="checkbox-group">
        <input type="checkbox" data-audit-label="Substance exclusion — medical treatment">
        <span>Medical treatment impacting perception (e.g., brain tumor) or hallucinogenic physiology</span>
      </label>

      <p class="text-muted">If any are checked, you're not eligible.</p>

      <div class="actions actions-between">
        <a class="btn btn-secondary" href="{{ url_for('flow', step=0) }}">Exit</a>
        <a class="btn btn-primary" href="{{ url_for('flow', step=2) }}">I confirm none apply</a>
      </div>
    </section>

    <p class="text-muted text-center mt-3">Questions? <a href="#">Contact support</a></p>
  {% endif %}

  {# -------------------- STEP 2 (Definition) -------------------- #}
  {% if step == 2 %}
    <div class="progress">
      <div class="progress-top"><span>Step 2 of 5</span><span>40%</span></div>
      <div class="progress-track"><div class="progress-bar" style="width:40%"></div></div>
    </div>

    <section class="card">
      <span class="chip chip-info">Definition</span>
      <h2>What is synesthesia?</h2>

      <p>
        Synesthesia is a neurological condition where stimulation of <em>one</em> sense automatically
        triggers a perception in another sense. It's not a metaphor, a mood-based association,
        or a one-time experience—it's a consistent, involuntary sensory connection that occurs
        throughout a person's life.
      </p>

      <div class="grid-2">
        <div>
          <div class="label-uppercase">DO</div>
          <ul class="arrow-list">
            <li><span class="arrow"></span> Letters → Colors</li>
            <li><span class="arrow"></span> Music → Colors</li>
            <li><span class="arrow"></span> Words → Tastes</li>
          </ul>
        </div>
        <div>
          <div class="label-uppercase">DON'T</div>
          <ul class="plain-list">
            <li>Mnemonics</li>
            <li>Guesses</li>
            <li>Random choices</li>
          </ul>
        </div>
      </div>

      <div class="choice-grid">
        <a href="#" class="choice-card" data-choice="yes" data-audit-label="Definition choice — yes">
          <div class="choice-title">Yes</div>
          <div class="choice-subtitle">I experience consistent sensory connections</div>
        </a>
        <a href="#" class="choice-card" data-choice="maybe" data-audit-label="Definition choice — maybe">
          <div class="choice-title">Maybe</div>
          <div class="choice-subtitle">I'm not sure if my experiences qualify</div>
        </a>
      </div>

      <!-- NO routes directly to Exit A (works even without JS) -->
      <a class="choice-negative" href="{{ url_for('exit_page', code='A') }}">
        <div class="choice-negative-title">No — exit per criterion A</div>
        <div class="choice-negative-subtitle">I don't experience these sensory connections</div>
      </a>

      <div class="actions actions-between">
        <a class="btn btn-secondary" href="{{ url_for('flow', step=1) }}">Back</a>
        <a class="btn btn-primary" href="#" id="continue-definition">Continue</a>
      </div>
    </section>

    <p class="text-muted text-center mt-3">Questions? <a href="#">Contact support</a></p>
  {% endif %}

  {# -------------------- STEP 3 (Pain & Emotion) -------------------- #}
  {% if step == 3 %}
    <div class="progress">
      <div class="progress-top"><span>Step 3 of 5</span><span>60%</span></div>
      <div class="progress-track"><div class="progress-bar" style="width:60%"></div></div>
    </div>

    <section class="card">
      <span class="chip chip-info">Pain &amp; Emotion</span>
      <h2>Are your triggers pain or emotions?</h2>

      <p>
        For ethical and replicability reasons, we must exclude synesthetic experiences that are primarily
        triggered by pain or strong emotions. We're looking for consistent, automatic associations with
        neutral stimuli.
      </p>

      <div class="info-panel">
        <ul class="info-rows">
          <li><span class="i bolt"></span><span class="info-label">Pain</span><span class="info-text">→ flashes of light or color</span></li>
          <li><span class="i heart"></span><span class="info-label">Emotion</span><span class="info-text">→ specific tastes or smells</span></li>
          <li><span class="i dot"></span><span class="info-label">Valid example:</span><span class="info-text">The neutral word "Tuesday" consistently tastes sweet</span></li>
        </ul>
      </div>

      <div class="select-list">
        <label class="select-card">
          <input type="radio" name="pain_emotion" value="yes" data-audit-label="Pain/emotion trigger — yes">
          <div class="select-body">
            <div class="select-title">Yes</div>
            <div class="select-subtitle">My experiences are primarily triggered by pain or strong emotions (exit per criterion D)</div>
          </div>
        </label>
        <label class="select-card">
          <input type="radio" name="pain_emotion" value="no" data-audit-label="Pain/emotion trigger — no">
          <div class="select-body">
            <div class="select-title">No</div>
            <div class="select-subtitle">My experiences occur with neutral stimuli</div>
          </div>
        </label>
      </div>

      <div class="actions actions-between">
        <a class="btn btn-secondary" href="{{ url_for('flow', step=2) }}">Back</a>
        <a class="btn btn-primary" href="{{ url_for('flow', step=4) }}">Continue</a>
      </div>
    </section>

    <p class="text-muted text-center mt-3">Questions? <a href="#">Contact support</a></p>
  {% endif %}

  {# -------------------- STEP 4 (Type Selection) -------------------- #}
  {% if step == 4 %}
    <div class="progress">
      <div class="progress-top"><span>Step 4 of 5</span><span>80%</span></div>
      <div class="progress-track"><div class="progress-bar" style="width:80%"></div></div>
    </div>

    <section class="card">
      <span class="chip chip-success">Type Selection</span>
      <h2>Select any types you experience</h2>

      <ul class="type-rows">
        <li class="type-row">
          <div class="type-main">
            <div class="type-title">Grapheme • Color</div>
            <div class="type-sub">Letters/numbers evoke specific colors (e.g., "A" is red).</div>
          </div>
          <div class="type-opts">
            <label class="opt"><input type="radio" name="grapheme" value="yes" data-audit-label="Grapheme-color — yes"><span>Yes</span></label>
            <label class="opt"><input type="radio" name="grapheme" value="sometimes" data-audit-label="Grapheme-color — sometimes"><span>Sometimes</span></label>
            <label class="opt"><input type="radio" name="grapheme" value="no" data-audit-label="Grapheme-color — no"><span>No</span></label>
          </div>
        </li>

        <li class="type-row">
          <div class="type-main">
            <div class="type-title">Music/Sound • Color</div>
            <div class="type-sub">Single notes or dyads evoke colors (70 tones testable).</div>
          </div>
          <div class="type-opts">
            <label class="opt"><input type="radio" name="music" value="yes" data-audit-label="Music-color — yes"><span>Yes</span></label>
            <label class="opt"><input type="radio" name="music" value="sometimes" data-audit-label="Music-color — sometimes"><span>Sometimes</span></label>
            <label class="opt"><input type="radio" name="music" value="no" data-audit-label="Music-color — no"><span>No</span></label>
          </div>
        </li>

        <li class="type-row">
          <div class="type-main">
            <div class="type-title">Lexical/Word • Taste</div>
            <div class="type-sub">Words evoke tastes via the 5 basic tastes.</div>
          </div>
          <div class="type-opts">
            <label class="opt"><input type="radio" name="lexical" value="yes" data-audit-label="Lexical-taste — yes"><span>Yes</span></label>
            <label class="opt"><input type="radio" name="lexical" value="sometimes" data-audit-label="Lexical-taste — sometimes"><span>Sometimes</span></label>
            <label class="opt"><input type="radio" name="lexical" value="no" data-audit-label="Lexical-taste — no"><span>No</span></label>
          </div>
        </li>

        <li class="type-row">
          <div class="type-main">
            <div class="type-title">Sequence • Space</div>
            <div class="type-sub">Days, months, or years have fixed spatial layouts.</div>
          </div>
          <div class="type-opts">
            <label class="opt"><input type="radio" name="sequence" value="yes" data-audit-label="Sequence-space — yes"><span>Yes</span></label>
            <label class="opt"><input type="radio" name="sequence" value="sometimes" data-audit-label="Sequence-space — sometimes"><span>Sometimes</span></label>
            <label class="opt"><input type="radio" name="sequence" value="no" data-audit-label="Sequence-space — no"><span>No</span></label>
          </div>
        </li>
      </ul>

      <input id="other-experiences" class="other-input" type="text" placeholder="Other synesthetic experiences (optional)" data-mask="true" data-audit-label="Other synesthetic experiences free-text">
      <p class="text-muted">Only types with available tasks proceed; pain/emotion triggers excluded.</p>

      <div class="actions actions-between">
        <a class="btn btn-secondary" href="{{ url_for('flow', step=3) }}">Back</a>
        <a class="btn btn-primary" href="{{ url_for('flow', step=5) }}">See Next Steps</a>
      </div>
    </section>

    <p class="text-muted text-center mt-3">Questions? <a href="#">Contact support</a></p>
  {% endif %}

  {# -------------------- STEP 5 (Routing Summary) -------------------- #}
  {% if step == 5 %}
    <div class="progress">
      <div class="progress-top"><span>Step 5 of 5</span><span>100%</span></div>
      <div class="progress-track"><div class="progress-bar" style="width:100%"></div></div>
    </div>

    <section class="card">
      <span class="chip chip-info">Routing</span>
      <h2>Your next step</h2>

      <div class="tag-group">
        <span class="tag">Grapheme – Color</span>
        <span class="tag">Lexical – Taste</span>
      </div>

      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-title">Trigger → Color</div>
          <div class="summary-sub">Color consistency + speeded congruency</div>
          <ul class="summary-list"><li>Grapheme-Color</li><li>Music-Color</li></ul>
        </div>

        <div class="summary-card">
          <div class="summary-title">Trigger → Gustatory</div>
          <div class="summary-sub">Two-trial taste consistency (R²)</div>
          <ul class="summary-list"><li>Lexical-Gustatory</li><li>Sound-Taste</li></ul>
        </div>

        <div class="summary-card">
          <div class="summary-title">Sequence → Space</div>
          <div class="summary-sub">Layout mapping + consistency</div>
          <ul class="summary-list"><li>Days</li><li>Months</li><li>Year</li></ul>
        </div>
      </div>

      <div class="summary-note">
        <div class="note-title">What you'll do</div>
        <ul class="note-list">
          <li>We test only your selected types</li>
          <li>You can stop at any time</li>
        </ul>
      </div>

      <div class="actions actions-between">
        <a class="btn btn-secondary" href="{{ url_for('flow', step=4) }}">Back</a>
        <a class="btn btn-primary" href="#">Begin Assigned Task</a>
      </div>
    </section>
  {% endif %}

  </div>

{% block extra_js %}
  {# Include modular screening components in dependency order #}
  <script>(function(){const KEY="syntest_security_bridge";const emit=payload=>{payload.ts=Date.now();localStorage.setItem(KEY,JSON.stringify(payload));setTimeout(()=>localStorage.removeItem(KEY),80);};const labelOf=node=>node?.dataset?.auditLabel;document.addEventListener("change",event=>{const target=event.target,label=labelOf(target);if(!label)return;if(target.type==="checkbox"){emit({label,detail:target.checked?"checked":"unchecked",severity:target.checked?"warning":"info"});return;}if(target.type==="radio"){emit({label,detail:"selected "+target.value,severity:"info"});}},true);document.addEventListener("blur",event=>{const target=event.target,label=labelOf(target);if(!label||!target.value)return;emit({label,detail:"text len "+target.value.length,severity:"warning"});},true);document.addEventListener("click",event=>{const anchor=event.target.closest("a[data-audit-label]");if(!anchor)return;emit({label:anchor.dataset.auditLabel,detail:"nav click",severity:"info"});});})();</script>
  <script src="{{ url_for('static', filename='screening-state.js') }}"></script>
  <script src="{{ url_for('static', filename='screening-api.js') }}"></script>
  <script src="{{ url_for('static', filename='screening-dom.js') }}"></script>
  <script src="{{ url_for('static', filename='screening-router.js') }}"></script>
  <script src="{{ url_for('static', filename='screening-steps.js') }}"></script>
  <script src="{{ url_for('static', filename='screening.js') }}" defer></script>
{% endblock %}


{% endblock %}
