{% extends "base.html" %}
{% block title %}SYNTEST — Word Color Test{% endblock %}

{% block extra_css %}
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="{{ url_for('static', filename='color.css') }}" />
{% endblock %}

{% block header %}
<div class="topbar">
  <a class="brand" href="/">SYNTEST</a>
  <div class="nav">
    <button class="btn btn-secondary btn-sm" id="helpBtn" type="button">Help</button>
  </div>
</div>
{% endblock %}

{% block content %}
<noscript>
  <div class="alert alert-error text-center">
    JavaScript is required to run the color tests. Please enable it and reload.
  </div>
</noscript>

<main class="shell">
  <div class="content">
    <header class="mb-4">
      <h1>WORD COLOR TEST</h1>
      <p class="lead">
        You'll assign a color to each <b>word</b>. <b>Click and hold</b> on the wheel and <b>drag</b> to adjust.
        <b>Click to lock</b> — the dot turns <b>red</b>. Press <b>Next</b> to save.
      </p>
    </header>

    <section class="card">
      <div class="card-header">
        <h2 class="card-title">Consistency Test</h2>
      </div>

      <div class="status">
        <div>Item: <span id="stimulusLabel">—</span></div>
        <div>Trial <span id="trialNum">1</span> / <span id="trialTotal">3</span></div>
        <div>Progress <span id="progress">0/0</span></div>
      </div>

      <div class="cct-grid">
        <aside class="howto">
          <h4>How to complete</h4>
          <ol class="list-spaced">
            <li>Read the word</li>
            <li><b>Click and hold</b> to adjust</li>
            <li>Click to <b>lock</b> (dot turns red)</li>
            <li>Press <b>Next</b></li>
          </ol>
        </aside>

        <div class="wheel-wrap">
          <div style="position: relative">
            <canvas id="wheel" width="360" height="360"></canvas>
            <span class="dot" id="dot"></span>
          </div>
          <p class="caption">Click and hold, then drag. Click to lock.</p>
        </div>

        <div class="swatch-wrap">
          <div id="stimulusBox" class="stimulus-box">
            <div id="stimulusContent">—</div>
          </div>
          <p class="caption">Current word</p>

          <div class="swatch" id="swatch" style="margin-top:12px;">
            <div class="hex" id="hex">———</div>
          </div>

          <div class="actions actions-center mt-3">
            <button id="btnNext" class="btn btn-primary" disabled>Next →</button>
          </div>
        </div>
      </div>

      <div class="trial-slider-container">
        <label for="trialSlider"><b>Trial:</b></label>
        <input type="range" id="trialSlider" min="1" max="3" value="1" step="1" />
      </div>
    </section>

    <section id="cctSummary" class="summary hidden"></section>
  </div>
</main>

<dialog id="helpDialog" class="help">
  <h3 id="helpTitle">Quick Help</h3>
  <ul class="list-spaced">
    <li>Read the word on the right.</li>
    <li><b>Click and hold</b> on the wheel, then <b>drag</b> to adjust.</li>
    <li>Click to <b>lock</b> your choice — the dot turns <b>red</b>.</li>
    <li>Press <b>Next</b> to save each choice.</li>
  </ul>
  <div class="actions actions-end mt-3">
    <button id="helpClose" class="btn btn-primary">OK</button>
  </div>
</dialog>
{% endblock %}

{% block footer %}
<!-- Override footer for full-screen test -->
{% endblock %}

{% block extra_js %}
<script type="module">
  import { WordColorTest } from "{{ url_for('static', filename='color/word_color_test.js') }}";

  const $ = id => document.getElementById(id);
  const ui = {
    wheel: $('wheel'),
    dot: $('dot'),
    swatch: $('swatch'),
    hex: $('hex'),
    stimulusContent: $('stimulusContent'),
    stimulusLabel: $('stimulusLabel'),
    trialNum: $('trialNum'),
    trialTotal: $('trialTotal'),
    progress: $('progress'),
    btnNext: $('btnNext'),
    trialSlider: $('trialSlider'),
    cctSummary: $('cctSummary'),
    helpBtn: $('helpBtn'),
    helpDialog: $('helpDialog'),
    helpClose: $('helpClose'),
  };

  new WordColorTest(ui, { trialsPerLabel: 3, wheelSize: 360, cutoffDistance: 135, allowNoColor: false });
</script>
{% endblock %}
