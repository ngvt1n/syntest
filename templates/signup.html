{% extends "base.html" %}
{% block title %}SYNTEST â€” Sign Up{% endblock %}

{% block content %}
<div class="container container-sm container-centered">
    <h1 class="text-center mb-4">Create Account</h1>

    {% if error %}
    <div class="alert alert-error">
        {{ error }}
    </div>
    {% endif %}

    <div class="card">
        <div class="role-selector">
            <div class="role-card active" id="participant-role" onclick="selectRole('participant')">
                <h3>Participant</h3>
                <p>Join as a study participant</p>
            </div>
            <div class="role-card" id="researcher-role" onclick="selectRole('researcher')">
                <h3>Researcher</h3>
                <p>Access as a researcher</p>
            </div>
        </div>

        <form method="POST" action="/signup" id="signup-form">
            <input type="hidden" name="role" id="role-input" value="participant">

            <div class="form-field">
                <label for="name">Full Name</label>
                <input type="text" id="name" name="name" required>
            </div>

            <div class="form-field">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" required>
            </div>

            <div class="form-field">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required minlength="8">
            </div>

            <div class="form-field">
                <label for="confirm-password">Confirm Password</label>
                <input type="password" id="confirm-password" name="confirm_password" required minlength="8">
            </div>

            <!-- Researcher-specific fields (hidden by default) -->
            <div id="researcher-fields" class="hidden">
                <div class="form-field">
                    <label for="institution">Institution</label>
                    <input type="text" id="institution" name="institution">
                </div>

                <div class="form-field">
                    <label for="access-code">Researcher Access Code</label>
                    <input type="text" id="access-code" name="access_code">
                </div>
            </div>

            <!-- Participant-specific fields (shown by default) -->
            <div id="participant-fields">
                <div class="form-field">
                    <label for="age">Age</label>
                    <input type="number" id="age" name="age" min="18" max="120">
                </div>

                <div class="form-field">
                    <label for="country">Country</label>
                    <input type="text" id="country" name="country" value="Spain">
                </div>
            </div>

            <button type="submit" class="btn btn-primary btn-block">Create Account</button>
        </form>

        <div class="text-center" style="margin-top: 20px;">
            <p class="text-muted">Already have an account? <a href="/login" class="footer-link">Login here</a></p>
        </div>
    </div>
</div>

<script>
    function selectRole(role) {
        // Update visual selection
        document.getElementById('participant-role').classList.remove('active');
        document.getElementById('researcher-role').classList.remove('active');
        document.getElementById(role + '-role').classList.add('active');

        // Update hidden form input
        document.getElementById('role-input').value = role;

        // Show/hide role-specific fields
        if (role === 'researcher') {
            document.getElementById('researcher-fields').classList.remove('hidden');
            document.getElementById('participant-fields').classList.add('hidden');
            document.getElementById('access-code').required = true;
            document.getElementById('age').required = false;
        } else {
            document.getElementById('researcher-fields').classList.add('hidden');
            document.getElementById('participant-fields').classList.remove('hidden');
            document.getElementById('access-code').required = false;
            document.getElementById('age').required = true;
        }
    }

    // Password confirmation validation
    document.getElementById('signup-form').addEventListener('submit', function (e) {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm-password').value;

        if (password !== confirmPassword) {
            e.preventDefault();
            alert('Passwords do not match!');
        }
    });
</script>
{% endblock %}
