<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SYNTEST – Letter Color Test</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet" />

  <!-- Styling shared by all color tests -->
  <link rel="stylesheet" href="{{ url_for('static', filename='color.css') }}?v=12" />
</head>

<body class="page-color">
  <noscript>
    <div style="background:#222;color:#fff;padding:10px 16px;text-align:center">
      JavaScript is required to run the color tests. Please enable it and reload.
    </div>
  </noscript>

  <div class="topbar">
    <div class="brand">SYNTEST</div>
    <div class="top-right">
      <button class="btn" id="helpBtn" type="button" aria-haspopup="dialog">Help</button>
    </div>
  </div>

  <main class="shell" role="main">
    <div class="content">
      <header class="hdr">
        <h1>LETTER COLOR TEST: CONSISTENCY &amp; SPEED</h1>
        <p class="sub">You’ll assign colors to <b>letters</b>. Each item repeats <b>3×</b>. Use a laptop/desktop; turn off blue-light filters.</p>
      </header>

      <section class="block" aria-labelledby="cct-heading">
        <h2 id="cct-heading" class="block-title">CONSISTENCY TEST</h2>

        <div class="status" aria-live="polite">
          <div>Item: <span id="stimulusLabel">—</span></div>
          <div>Trial <span id="trialNum">1</span> / <span id="trialTotal">3</span></div>
          <div>Progress <span id="progress">0/0</span></div>
        </div>

        <div id="cctContainer" class="cct-grid">
          <!-- Color wheel -->
          <div class="wheel-wrap">
            <div style="position: relative">
              <canvas
                id="wheel"
                width="360"
                height="360"
                aria-label="Color selection area"
                aria-describedby="wheelTip"
              ></canvas>
              <span class="dot" id="dot" aria-hidden="true"></span>
            </div>
            <div class="wheel-actions">
              <button id="btnNone" class="btn" type="button">No color</button>
            </div>
          </div>

          <!-- Stimulus -->
          <div id="stimulusBox" class="stimulus-box" aria-label="Stimulus">
            <div id="stimulusContent">—</div>
          </div>

          <!-- Preview + Next -->
          <div class="swatch-wrap">
            <div class="swatch" id="swatch" aria-label="Selected color preview">
              <div class="hex" id="hex">———</div>
            </div>
            <div class="nav">
              <button id="btnNext" class="btn btn-primary" type="button" disabled>Next →</button>
            </div>
            <p class="tip" id="wheelTip">Move over the wheel to select. Press <b>N</b> to toggle “No color”.</p>
          </div>
        </div>

        <!-- Dev slider (kept visually unobtrusive by CSS) -->
        <div class="trial-slider-container" aria-hidden="true">
          <label for="trialSlider"><b>Trial:</b></label>
          <input type="range" id="trialSlider" min="1" max="3" value="1" step="1" />
        </div>
      </section>

      <section id="cctSummary" class="summary hidden"></section>
    </div>
  </main>

  <!-- Help dialog -->
  <dialog id="helpDialog" class="help" aria-labelledby="helpTitle">
    <h3 id="helpTitle">Quick Help</h3>
    <ul>
      <li>Look at the letter in the middle.</li>
      <li>Pick the color that best matches your automatic experience.</li>
      <li>Use “No color” if you have none for that item.</li>
      <li>Each letter repeats 3× in random order.</li>
    </ul>
    <div class="dlg-actions">
      <button id="helpClose" class="btn btn-primary" type="button">OK</button>
    </div>
  </dialog>

  <!-- Module init (keeps all IDs your JS expects) -->
  <script type="module">
    import { LetterColorTest } from "{{ url_for('static', filename='color/letter_color_test.js') }}";

    const $ = id => document.getElementById(id);
    const ui = {
      wheel: $('wheel'),
      dot: $('dot'),
      swatch: $('swatch'),
      hex: $('hex'),
      stimulusContent: $('stimulusContent'),
      stimulusLabel: $('stimulusLabel'),
      trialNum: $('trialNum'),
      trialTotal: $('trialTotal'),
      progress: $('progress'),
      btnNext: $('btnNext'),
      btnNone: $('btnNone'),
      trialSlider: $('trialSlider'),
      cctSummary: $('cctSummary'),
      helpBtn: $('helpBtn'),
      helpDialog: $('helpDialog'),
      helpClose: $('helpClose'),
    };

    new LetterColorTest(ui, { trialsPerLabel: 3, wheelSize: 360, cutoffDistance: 135 });
  </script>
</body>
</html>
